<!DOCTYPE html>
<%
    # i18n ì‚¬ì „ ì„¤ì •
    i18n = {
        'ko': {
            'user_analysis': 'ì‚¬ìš©ìž ë¶„ì„',
            'leaderboard_analysis': 'ë¦¬ë”ë³´ë“œ ë¶„ì„',
            'metric_standard': 'ì§€í‘œ ê¸°ì¤€',
            'rank': 'ìˆœìœ„',
            'crank': 'cìˆœìœ„',
            'mindshare': 'ë§ˆì¸ë“œì‰ì–´',
            'cmindshare': 'cë§ˆì¸ë“œì‰ì–´',
            'followers': 'íŒ”ë¡œì›Œ',
            'smart_followers': 'ìŠ¤ë§ˆíŠ¸ íŒ”ë¡œì›Œ',
            'chart_title': 'ìˆœìœ„ ë° ë§ˆì¸ë“œì‰ì–´ ë³€í™” ë¶„ì„',
            'chart_loading': 'ì°¨íŠ¸ ë°ì´í„° ë¡œë”© ì¤‘...',
            'search_placeholder': 'ë‹¤ë¥¸ ì‚¬ìš©ìž ê²€ìƒ‰ (ì´ë¦„ ë˜ëŠ” ID)',
            'close': 'ë‹«ê¸°',
            'copy_success': 'ì§€ê°‘ ì£¼ì†Œê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤! ðŸ¦ˆ',
            'click_to_copy': 'í´ë¦­í•˜ì—¬ ì£¼ì†Œ ë³µì‚¬ ðŸ¦ˆ'
        },
        'en': {
            'user_analysis': 'User Analysis',
            'leaderboard_analysis': 'Leaderboard',
            'metric_standard': 'Metric',
            'rank': 'Rank',
            'crank': 'cRank',
            'mindshare': 'Mindshare',
            'cmindshare': 'cMindshare',
            'followers': 'Followers',
            'smart_followers': 'Smart Followers',
            'chart_title': 'Rank & Mindshare Analysis',
            'chart_loading': 'Loading Chart Data...',
            'search_placeholder': 'Search other users (Name or ID)',
            'close': 'Close',
            'copy_success': 'Wallet address copied! ðŸ¦ˆ',
            'click_to_copy': 'Click to copy addressðŸ¦ˆ'
        }
    }
    t = i18n.get(lang, i18n['ko'])
%>
<html lang="{{lang}}">
% include('_head.html')
<link rel="stylesheet" href="/static/css/user.css">
<title>{{project.upper()}} {{ user_info.get('displayName', username) }} {{t['user_analysis']}} - SHARKAPP</title>
</head>
<body>
% include('_navbar.html')

<div class="container mt-4">
    <!-- ì‚¬ìš©ìž í”„ë¡œí•„ ì¹´ë“œ -->
    <div class="card mb-4 shadow-sm">
        <div class="card-body">
            <div class="row align-items-center">
                <div class="col-auto">
                    % if user_info.get('profileImageUrl'):
                        <img src="{{ user_info['profileImageUrl'] }}" alt="{{ user_info.get('displayName', username) }}" style="width: 80px; height: 80px; border-radius: 50%;">
                    % end
                </div>
                <div class="col">
                    <h2 class="mb-1">
                        <a href="https://x.com/{{username}}" class="user-link" target="_blank">{{ user_info.get('displayName', username) }}</a>
                    </h2>
                    <p class="text-muted mb-2">
                        <a href="https://x.com/{{username}}" class="user-link" target="_blank">@{{ username }}</a>
                    </p>
                    <div class="d-flex gap-4">
                        <div>
                            <small class="text-muted d-block">{{t['followers']}}</small>
                            <strong>{{ "{:,}".format(user_info.get('followers', 0)) }}</strong>
                        </div>
                        <div>
                            <small class="text-muted d-block">{{t['smart_followers']}}</small>
                            <strong>{{ "{:,}".format(user_info.get('smartFollowers', 0)) }}</strong>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- íƒ€ìž„í”„ë ˆìž„ë³„ í†µê³„ -->
    <div class="mb-4">
        <h4 class="mb-3">{{ t['rank'] if metric == 'snapsPercent' else t['crank'] }} & {{ t['mindshare'] if metric == 'snapsPercent' else t['cmindshare'] }}</h4>
        <div class="row g-3">
            % for tf in timeframes:
                <%
                    tf_info = user_info_by_timeframe.get(tf, {})
                    tf_rank = tf_info.get(rank_col, '-')
                    tf_mindshare = tf_info.get(mindshare_col, 0.0)
                %>
                <div class="col-6 col-md-3">
                    <div class="card h-100 text-center shadow-sm">
                        <div class="card-body">
                            <h6 class="card-subtitle mb-2 text-muted fw-bold">{{ tf }}</h6>
                            <div class="mb-2">
                                <small class="text-muted d-block">{{ t['rank'] if metric == 'snapsPercent' else t['crank'] }}</small>
                                <h3 class="mb-0 text-primary">{{ tf_rank if tf_rank != '-' else '-' }}</h3>
                            </div>
                            <div>
                                <small class="text-muted d-block">{{ t['mindshare'] if metric == 'snapsPercent' else t['cmindshare'] }}</small>
                                <h4 class="mb-0 text-success">{{ "{:.2f}%".format(tf_mindshare) if tf_mindshare else '-' }}</h4>
                            </div>
                        </div>
                    </div>
                </div>
            % end
        </div>
    </div>

    <div class="chart-container" style="margin-top: 0;">
        <div class="mb-1">
            <form method="get" action="/cookie/{{project}}/user/{{ username }}" id="analysisOptionsForm">
                <div class="row g-3">
                    <div class="col-12 col-lg-auto d-flex align-items-center">
                        <select class="form-select" id="metric" name="metric" onchange="document.getElementById('analysisOptionsForm').submit()">
                            <option value="snapsPercent" {{ 'selected' if metric == 'snapsPercent' else '' }}>Mindshare</option>
                            <option value="cSnapsPercent" {{ 'selected' if metric == 'cSnapsPercent' else '' }}>cMindshare</option>
                        </select>
                    </div>
                </div>
            </form>
        </div>
        <div class="card">
            <div class="card-header">
                <h3>{{ t['chart_title'] }}</h3>
            </div>
            <div class="card-body chart-relative" id="chartCardBody">
                <div id="chart-loading-overlay" class="chart-loading-overlay">
                    {{ t['chart_loading'] }}
                </div>
                {{ !user_chart }}
            </div>
        </div>
    </div>

    <!-- ì‚¬ìš©ìž ê²€ìƒ‰ì°½ -->
    <div class="row mb-4">
        <div class="col-md-8 search-container">
            <input type="text" class="form-control" id="userSearchInput" placeholder="{{t['search_placeholder']}}">
            <div id="searchResults" class="search-dropdown"></div>
        </div>
    </div>
</div>

<script>
    // ì „ì—­ ë³€ìˆ˜ ì„¤ì •
    window.allUsersData = {{ !all_users }};
    window.currentProject = "{{project}}";
    window.currentTimeframe = "{{ timeframe }}";
</script>
<script src="/static/js/user.js"></script>

% include('_footer.html')
</body>
</html>
