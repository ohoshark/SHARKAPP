<!DOCTYPE html>
<%
    # i18n ì‚¬ì „ ì„¤ì •
    i18n = {
        'ko': {
            'user_analysis': 'ì‚¬ìš©ìž ë¶„ì„',
            'leaderboard_analysis': 'ë¦¬ë”ë³´ë“œ ë¶„ì„',
            'position': 'ìˆœìœ„',
            'mindshare': 'ë§ˆì¸ë“œì‰ì–´',
            'rank': 'X Score',
            'score': 'X Score',
            'chart_title': 'ìˆœìœ„ ë° ë§ˆì¸ë“œì‰ì–´ ë³€í™” ë¶„ì„',
            'chart_loading': 'ì°¨íŠ¸ ë°ì´í„° ë¡œë”© ì¤‘...',
            'search_placeholder': 'ë‹¤ë¥¸ ì‚¬ìš©ìž ê²€ìƒ‰ (ì´ë¦„ ë˜ëŠ” ID)',
            'close': 'ë‹«ê¸°',
            'copy_success': 'ì§€ê°‘ ì£¼ì†Œê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤! ðŸ¦ˆ',
            'click_to_copy': 'í´ë¦­í•˜ì—¬ ì£¼ì†Œ ë³µì‚¬ ðŸ¦ˆ'
        },
        'en': {
            'user_analysis': 'User Analysis',
            'leaderboard_analysis': 'Leaderboard',
            'position': 'Rank',
            'mindshare': 'Mindshare',
            'rank': 'X Score',
            'score': 'X Score',
            'chart_title': 'Rank & Mindshare Analysis',
            'chart_loading': 'Loading Chart Data...',
            'search_placeholder': 'Search other users (Name or ID)',
            'close': 'Close',
            'copy_success': 'Wallet address copied! ðŸ¦ˆ',
            'click_to_copy': 'Click to copy addressðŸ¦ˆ'
        }
    }
    t = i18n.get(lang, i18n['ko'])
%>
<html lang="{{lang}}">
% include('_head.html')
<link rel="stylesheet" href="/static/css/user.css?v2">
<title>{{display_project_name}} {{ user_info.get('name', username) }} {{t['user_analysis']}} - SHARKAPP</title>
</head>
<body>
% include('_navbar.html')

<div class="container mt-4">
    <!-- ì‚¬ìš©ìž í”„ë¡œí•„ ì¹´ë“œ -->
    <!-- ì¹´ë“œ í•˜ë‹¨ ì¤‘ì•™ ëª¨ì„œë¦¬ì— ê²¹ì¹˜ëŠ” í†µí•© ê²€ìƒ‰ ë²„íŠ¼ -->
    <div class="card mb-4 shadow-sm" style="position:relative;">
        <div class="card-body">
            <div class="row align-items-center">
                <div class="col-auto">
                    % if user_info.get('imageUrl'):
                        <img src="{{ user_info['imageUrl'] }}" alt="{{ user_info.get('name', username) }}" style="width: 80px; height: 80px; border-radius: 50%;" onerror="this.style.display='none'">
                    % end
                </div>
                <div class="col">
                    <h2 class="mb-1"><a href="https://x.com/{{username}}" class="user-link" target="_blank">{{ user_info.get('name', username) }}</a></h2>
                    <p class="text-muted mb-2"><a href="https://x.com/{{username}}" class="user-link" target="_blank">@{{ username }}</a></p>
                    <div class="d-flex gap-4">
                        <!-- <div>
                            <small class="text-muted d-block">{{t['rank']}}</small>
                            <strong>{{ user_info.get('rank', '-') }}</strong>
                        </div> -->
                        <div>
                            <small class="text-muted d-block">{{t['score']}}</small>
                            <strong>{{ "{:,.0f}".format(user_info.get('score', 0)) if user_info.get('score') else '-' }}</strong>
                        </div>
                    </div>
                </div>
            </div>
        </div>
                <!-- ì—¬ê¸°! -->
        <a href="/user-lookup?username={{username}}" class="user-search-fab" title="global search">
            <i class="fas fa-search"></i> í†µí•© ê²€ìƒ‰
        </a>
    </div>



    <!-- íƒ€ìž„í”„ë ˆìž„ë³„ í†µê³„ -->
    <div class="mb-4">
        <h4 class="mb-3">{{ t['position'] }} & {{ t['mindshare'] }}</h4>
        <div class="row g-3">
            % for tf in timeframes:
                <%
                    tf_info = user_info_by_timeframe.get(tf, {})
                    # ë°ì´í„°ê°€ ì—†ëŠ” ê²½ìš° ê±´ë„ˆë›°ê¸°
                    if not tf_info:
                        continue
                    end
                    tf_position = tf_info.get('position', '-')
                    tf_mindshare = tf_info.get('mindsharePercentage', 0.0)
                %>
                <div class="col-6 col-md-3">
                    <div class="card h-100 text-center shadow-sm">
                        <div class="card-body">
                            <h6 class="card-subtitle mb-2 text-muted fw-bold">{{ tf }}</h6>
                            <div class="mb-2">
                                <small class="text-muted d-block">{{ t['position'] }}</small>
                                <h3 class="mb-0 text-primary">{{ tf_position if tf_position != '-' else 'out' }}</h3>
                            </div>
                            <div>
                                <small class="text-muted d-block">{{ t['mindshare'] }}</small>
                                <h4 class="mb-0 text-success">{{ "{:.2f}%".format(tf_mindshare) if tf_mindshare else '-' }}</h4>
                            </div>
                        </div>
                    </div>
                </div>
            % end
        </div>
    </div>

    % if user_chart:
    <div class="chart-container" style="margin-top: 0;">
        <div class="card">
            <div class="card-header">
                <h3>{{ t['chart_title'] }}</h3>
            </div>
            <div class="card-body chart-relative" id="chartCardBody">
                <div id="chart-loading-overlay" class="chart-loading-overlay">
                    {{ t['chart_loading'] }}
                </div>
                {{ !user_chart }}
            </div>
        </div>
    </div>
    % end

    <!-- ì‚¬ìš©ìž ê²€ìƒ‰ì°½ -->
    <div class="row mb-4">
        <div class="col-md-8 search-container">
            <input type="text" class="form-control" id="userSearchInput" placeholder="{{t['search_placeholder']}}">
            <div id="searchResults" class="search-dropdown"></div>
        </div>
    </div>
</div>

<script>
    // ì „ì—­ ë³€ìˆ˜ ì„¤ì •
    window.allUsersData = {{ !all_users }};
    window.currentProject = "{{project}}";
    window.currentTimeframe = "{{ timeframe }}";
    window.isWallchain = true;
</script>
<script src="/static/js/user.js"></script>

% include('_footer.html')
</body>
</html>
