<!DOCTYPE html>
<%
    i18n = {
        'ko': {
			'pre': 'ì´ì „',
			'cur': 'í˜„ì¬',
			'change': 'ë³€í™”',
			'ms': 'ë§ˆì‰',
            'title_suffix': 'ë¦¬ë”ë³´ë“œ ë³€í™” ë¶„ì„',
            'user_analysis': 'ì‚¬ìš©ì ë¶„ì„',
            'leaderboard_analysis': 'ë¦¬ë”ë³´ë“œ ë¶„ì„',
            'data_standard': 'ë°ì´í„° ê¸°ì¤€',
            'metric_standard': 'ì§€í‘œ ê¸°ì¤€',
            'compare_btn': 'ë¹„êµí•˜ê¸°',
            'prev_point': 'ì´ì „ ì‹œì ',
            'curr_point': 'í˜„ì¬ ì‹œì ',
			'recent_9hour': 'ìµœê·¼ 9ì‹œê°„',
			'Analysis_Result': 'ë¶„ì„ ê²°ê³¼',
            'rank': 'ìˆœìœ„',
            'user': 'ì‚¬ìš©ì',
			'pre_rank': 'ì´ì „ ìˆœìœ„',
			'curr_rank': 'í˜„ì¬ ìˆœìœ„',
            'rank_change': 'ìˆœìœ„ ë³€í™”',
			'pre_ms': 'ì´ì „ ë§ˆì‰',
			'curr_ms': 'í˜„ì¬ ë§ˆì‰',
			'ms_change': 'ë§ˆì‰ ë³€í™”',
			'result': 'ë¶„ì„ ê²°ê³¼',
            'search_placeholder': 'ì‚¬ìš©ì ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”',
            'close': 'ë‹«ê¸°',
            'copy_success': 'ì§€ê°‘ ì£¼ì†Œê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ¦ˆ',
            'click_to_copy': 'í´ë¦­í•˜ì—¬ ì£¼ì†Œ ë³µì‚¬ ğŸ¦ˆ'
        },
        'en': {
			'pre': 'Pre',
			'cur': 'Cur',
			'change': 'Change',
			'ms': 'MS',
            'title_suffix': 'Leaderboard Analysis',
            'user_analysis': 'User Analysis',
            'leaderboard_analysis': 'Leaderboard',
            'data_standard': 'Time',
            'metric_standard': 'Metric',
            'compare_btn': 'COMPARE',
            'prev_point': 'Prev Point',
            'curr_point': 'Curr Point',
			'recent_9hour': 'Recent 9H',
			'Analysis_Result': 'Analysis Result',
            'rank': 'Rank',
            'user': 'User',
			'pre_rank': 'Pre Rank',
			'curr_rank': 'Cur Rank',
            'rank_change': 'Rank Change',
			'pre_ms': 'Pre MS',
			'curr_ms': 'Cur MS',
			'ms_change': 'MS Change',
			'result': 'Analysis Result',
            'search_placeholder': 'Enter username...',
            'close': 'Close',
            'copy_success': 'Wallet address copied! ğŸ¦ˆ',
            'click_to_copy': 'Click to copy addressğŸ¦ˆ'
        }
    }
    t = i18n.get(lang, i18n['ko'])
%>
<html lang="{{lang}}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{project.upper()}} ë¦¬ë”ë³´ë“œ ë¶„ì„ - SHARKAPP</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.11.5/css/dataTables.bootstrap5.min.css">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/15.7.0/nouislider.min.css">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">	
 	<script src="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/15.7.0/nouislider.min.js"></script>
	<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
	<script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
	<script src="https://cdn.datatables.net/1.11.5/js/dataTables.bootstrap5.min.js"></script>
	<script src="https://unpkg.com/twemoji@latest/dist/twemoji.min.js" crossorigin="anonymous"></script>
	<link rel="stylesheet" href="/static/css/leaderboard.css">
	<style>
		/* DataTables í˜ì´ì§• ì»¨íŠ¸ë¡¤ ìŠ¤íƒ€ì¼ í†µì¼ */
		.dataTables_wrapper .dataTables_length select {
			padding: 0.375rem 2.25rem 0.375rem 0.75rem;
			border: 1px solid #dee2e6;
			border-radius: 0.25rem;
			background-color: #fff;
			font-size: 1rem;
			line-height: 1.5;
			margin-top: 3px;
		}
		
		.dataTables_wrapper .dataTables_length,
		.dataTables_wrapper .dataTables_paginate {
			display: flex;
			align-items: center;
			justify-content: center;
			padding: 0.5rem 0;
		}
		
		.dataTables_wrapper .dataTables_length {
			justify-content: flex-start;
		}
		
		.dataTables_wrapper .dataTables_paginate {
			justify-content: flex-end;
		}
		
		@media (max-width: 767.98px) {
			.table-responsive td:nth-of-type(1):before { content: "{{t['user']}}"; }
		.table-responsive td:nth-of-type(2):before { content: "{{t['prev_point']}}"; }
		.table-responsive td:nth-of-type(3):before { content: "{{t['curr_point']}}"; }
		.table-responsive td:nth-of-type(4):before { content: "{{t['rank_change']}}"; }
		.table-responsive td:nth-of-type(5):before { content: "{{t['pre']}} {{_col_metric}}{{t['ms']}}"; }
		.table-responsive td:nth-of-type(6):before { content: "{{t['cur']}} {{_col_metric}}{{t['ms']}}"; } 
		.table-responsive td:nth-of-type(7):before { content: "{{_col_metric}}{{t['ms']}} {{t['change']}}"; } 
		
			/* ëª¨ë°”ì¼ì—ì„œ í˜ì´ì§• ì»¨íŠ¸ë¡¤ ê°„ê²© ì¡°ì • */
			.dataTables_wrapper .dataTables_length,
			.dataTables_wrapper .dataTables_paginate {
				padding: 0.5rem 0.25rem;
			}
			}
	</style>
</head>

<body>
% include('_navbar.html')

    <div class="container mt-4">
        <!-- <h1 class="mb-4">{{project.upper()}} ë¦¬ë”ë³´ë“œ ë³€í™” ë¶„ì„</h1> -->
        
        <div class="card timestamp-selector">
            <div class="card-header">
                <h3 class="mb-0">{{display_project_name.upper()}} {{t['title_suffix']}}</h3>
            </div>
				<div class="card-body">
					<form method="get" action="/cookie/{{project}}/leaderboard" id="comparisonForm">
						<div class="row mb-3">
							<div class="col-md-4">
								<label class="form-label fw-bold">{{t['data_standard']}}</label>
								<select class="form-select" id="timeframe" name="timeframe" onchange="updateFilters()">
									% for tf in timeframes:
										<option value="{{ tf }}" {{ 'selected' if tf == timeframe else '' }}>{{ tf }}</option>
									% end
								</select>
							</div>
							
							<div class="col-md-4">
								<label class="form-label fw-bold">{{t['metric_standard']}}</label>
								<select class="form-select" id="metric" name="metric" onchange="this.form.submit()">
									<option value="snapsPercent" {{ 'selected' if metric == 'snapsPercent' else '' }}>Mindshare</option>
									<option value="cSnapsPercent" {{ 'selected' if metric == 'cSnapsPercent' else '' }}>cMindshare</option>
								</select>
							</div>
						</div>
					<div class="row mb-4">
						<div class="col-12">
							<div class="d-flex justify-content-between mb-3">
								<div class="text-start">
									<strong>{{t['prev_point']}}</strong> 
									<span id="slider-timestamp1" class="text-muted"></span>
								</div>
								<div class="text-end">
									<strong>{{t['curr_point']}}</strong> 
									<span id="slider-timestamp2" class="text-muted"></span>
								</div>
							</div>
							
							<div id="timeSlider" style="margin: 0 10px;"></div>
							
							<input type="hidden" id="timestamp1" name="timestamp1" value="{{ timestamp1 }}">
							<input type="hidden" id="timestamp2" name="timestamp2" value="{{ timestamp2 }}">
						</div>
					</div>
				
				<div class="d-flex justify-content-end mt-5">
					<button type="button" class="btn btn-primary me-3" onclick="resetToRecent()">
							{{t['recent_9hour']}}
						</button>
						<button type="submit" class="btn btn-primary px-4">{{t['compare_btn']}}</button>
				</div>
				</form>
			</div>
		</div>
        
        <div class="card comparison-table">
            <div class="card-header">
                <h3>
                    {{t['result']}} 
                    <small class="text-muted">
                        ({{ timestamp1_display }} â†’ {{ timestamp2_display }})
                    </small>
                </h3>
            </div>
			<div class="card-body">
				<div class="table-responsive">
					{{ !table_html }} </div>
			</div>
        </div>
    </div>

    <script>
		// Check if Bootstrap is loaded
		if (typeof bootstrap === 'undefined') {
			console.error('Bootstrap is not loaded!');
		} else {
			console.log('Bootstrap version:', bootstrap.Tooltip.VERSION);
		}
		
		// Compressed data - minified for performance
		const rawTimestamps = {{ !timestamps }};
		const formattedTimestamps = {{ !formatted_timestamps }};


		const currentTs1 = "{{ timestamp1 }}";
		const currentTs2 = "{{ timestamp2 }}";

		const timestampMap = {};
		rawTimestamps.forEach((ts, index) => {
			timestampMap[ts] = index;
		});


		document.addEventListener('DOMContentLoaded', function() {
			const slider = document.getElementById('timeSlider');
			const input1 = document.getElementById('timestamp1');
			const input2 = document.getElementById('timestamp2');
			const display1 = document.getElementById('slider-timestamp1');
			const display2 = document.getElementById('slider-timestamp2');

			if (rawTimestamps.length >= 2) {
				const min_index = 0;
				const max_index = rawTimestamps.length - 1;
				let start1_index = timestampMap[currentTs1];
				let start2_index = timestampMap[currentTs2];

				const start1 = (start1_index === undefined) ? rawTimestamps.length - 2 : start1_index;
				const start2 = (start2_index === undefined) ? rawTimestamps.length - 1 : start2_index;

				noUiSlider.create(slider, {
					start: [start1, start2], 
					connect: true,
					step: 1, 
					range: {
						'min': 0,
						'max': rawTimestamps.length - 1
					},
					pips: { 
						mode: 'count',
						values: 5,
						density: 4
					}
				});

				slider.noUiSlider.on('update', function (values, handle) {
					const index1 = Math.round(values[0]);
					const index2 = Math.round(values[1]);
					
					const newTs1 = rawTimestamps[index1];
					const newTs2 = rawTimestamps[index2];
					
					input1.value = newTs1;
					input2.value = newTs2;
					
					display1.textContent = formattedTimestamps[newTs1] || newTs1;
					display2.textContent = formattedTimestamps[newTs2] || newTs2;
					
					const handles = slider.getElementsByClassName('noUi-handle');
					
					if (handles[0]) {
						if (index1 === min_index) {
							handles[0].classList.add('red-indicator');
						} else {
							handles[0].classList.remove('red-indicator');
						}
					}
				
					if (handles[1]) {
						if (index2 === max_index) {
							handles[1].classList.add('red-indicator');
						} else {
							handles[1].classList.remove('red-indicator');
						}
					}
				});
			} else {
				document.getElementById('timeSlider').innerHTML = '<p class="text-warning">ë¹„êµ ê°€ëŠ¥í•œ íƒ€ì„ìŠ¤íƒ¬í”„ ë°ì´í„°ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤.</p>';
			}
			
			
			document.getElementById('comparisonForm').addEventListener('submit', function(e) {
				if (input1.value === input2.value) {
					e.preventDefault();
					alert('ë¹„êµë¥¼ ìœ„í•´ ì„œë¡œ ë‹¤ë¥¸ ì‹œê°„ëŒ€ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
					return false;
				}
			});
		});
    </script>
	<script>
		$.fn.dataTable.ext.type.order['special-num-pre'] = function ( data ) {
			let num = data.replace(/[â†‘â†“,-]/g, ''); 
			
			if (num === '') {
				return 0;
			}
			
			return parseFloat(num);
		};


		$(document).ready(function() {
		// Check if leaderboard table exists
		const $tableElement = $('#leaderboardTable');
	let table = null;
	
	if ($tableElement.length > 0) {
		table = $tableElement.DataTable({
			"dom": "<'row'<'col-6 col-md-6'l><'col-6 col-md-6'p>>" +
				   "<'row'<'col-sm-12'tr>>" +
				   "<'row'<'col-sm-12 text-center'i>>",
			"paging": true,
			"pageLength": 300,
			"lengthMenu": [[100, 300, 500, -1], [100, 300, 500, "All"]],
			"info": true,
			"ordering": true,
			"searching": false,
			"language": {
				"emptyTable": "ë¹„êµí•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.",
				"zeroRecords": "ì¼ì¹˜í•˜ëŠ” ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.",
				"info": "",
				"infoEmpty": "0ê°œ í•­ëª©",
				"lengthMenu": "_MENU_",
				"paginate": {
					"first": "<<",
					"last": ">>",
					"next": ">",
					"previous": "<"
				}
			},
			"order": [[2, 'asc']], 
			"columnDefs": [
				{ "orderable": false, "targets": 0 },
				{ "orderable": true, "targets": "_all" }
			]
		});
		
		$('.dataTables_wrapper').addClass('no-footer');

		let currentSortColumn = 2; 
		let currentSortDirection = 'desc'; 

		const initialIndicator = (currentSortDirection === 'desc') ? ' â–²' : ' â–¼';
		const defaultSortOption = $('.sort-option[data-column="' + currentSortColumn + '"]');
		if (defaultSortOption.length) {
			defaultSortOption.text(defaultSortOption.text() + initialIndicator);
		}
		$('#fabSortDropdown i').removeClass().addClass('fas fa-sort-amount-down-alt'); // 'desc' ë°©í–¥ ì•„ì´ì½˜
		
		$('.sort-option').on('click', function(e) {
			e.preventDefault();
			
			if (!table) {
				console.warn('Table not initialized');
				return;
			}
			
			const requestedColumn = parseInt($(this).data('column'));
			const defaultDirection = $(this).data('default-dir') || 'desc'; 
			let newDirection;

			if (requestedColumn === currentSortColumn) {
				newDirection = (currentSortDirection === 'asc') ? 'desc' : 'asc';
			} else {
				newDirection = defaultDirection;
			}

			$('.sort-option').each(function() {
				let text = $(this).text().replace(' â–²', '').replace(' â–¼', '');
				$(this).text(text);
			});

			table.order([requestedColumn, newDirection]).draw();

			currentSortColumn = requestedColumn;
			currentSortDirection = newDirection;

			const indicator = (newDirection === 'asc') ? ' â–²' : ' â–¼';
			const currentText = $(this).text();
			$(this).text(currentText + indicator);

			const iconClass = (newDirection === 'asc') ? 'fa-sort-amount-up-alt' : 'fa-sort-amount-down-alt';
			$('#fabSortDropdown i').removeClass().addClass('fas ' + iconClass);
		});
	} else {
		console.warn('Leaderboard table not found - FAB sort will not work');
	}
	
	// User search functionality (always initialize)
	const $usernameInput = $('#usernameInput');
	const $searchResults = $('#searchResults');
	const searchModalElement = document.getElementById('searchModal');
	const searchModal = new bootstrap.Modal(searchModalElement);
		
// ê¸°ì¡´ ì½”ë“œ ë¶€ë¶„ì„ ì•„ë˜ì™€ ê°™ì´ ìˆ˜ì •
function searchUsers(query) {
    $searchResults.empty();
    if (query.length < 2) { 
        $searchResults.append('<div class="list-group-item">ìµœì†Œ 2ê¸€ì ì´ìƒ ì…ë ¥í•´ì£¼ì„¸ìš”.</div>');
        return;
    }

    const lowerQuery = query.toLowerCase();
    const foundUsers = [];
    
    // table ë³€ìˆ˜ê°€ ì •ìƒì ìœ¼ë¡œ DataTable ê°ì²´ì¸ì§€ í™•ì¸ í•„ìš”
    table.rows().every(function() { 
        const rowData = this.data();
        // i18nìœ¼ë¡œ ì¸í•´ HTMLì´ í¬í•¨ë  ìˆ˜ ìˆìœ¼ë¯€ë¡œ jQueryë¥¼ ì´ìš©í•´ í…ìŠ¤íŠ¸ë§Œ ì¶”ì¶œ
        // ë§Œì•½ ì²« ë²ˆì§¸ ì»¬ëŸ¼(0)ì´ ì‚¬ìš©ì ì´ë¦„ì´ ì•„ë‹ˆë¼ë©´ ì¸ë±ìŠ¤ë¥¼ ìˆ˜ì •í•´ì•¼ í•©ë‹ˆë‹¤.
        const username = $('<div>' + rowData[0] + '</div>').text().trim(); 
        
        if (username.toLowerCase().includes(lowerQuery)) {
            foundUsers.push({
                username: username,
                index: this.index() // í–‰ ì¸ë±ìŠ¤ ì €ì¥
            });
        }
    });

    if (foundUsers.length === 0) {
        $searchResults.append('<div class="list-group-item list-group-item-warning">ì¼ì¹˜í•˜ëŠ” ì‚¬ìš©ìê°€ ì—†ìŠµë‹ˆë‹¤.</div>');
        return;
    }

    foundUsers.forEach(function(user) {
        const $item = $(
            '<a href="#" class="list-group-item list-group-item-action" ' +
            'data-username="' + user.username + '">' + 
            user.username + '</a>'
        );
        $searchResults.append($item);
    });
}

		let searchTimer;
		$usernameInput.on('keyup', function() {
			clearTimeout(searchTimer);
			const query = $usernameInput.val().trim();
			searchTimer = setTimeout(function() {
				searchUsers(query);
			}, 300);
		});

$searchResults.on('click', 'a.list-group-item-action', function(e) {
    e.preventDefault();
    const usernameToFind = $(this).data('username');
    let targetRowIndex = null;

    // ì „ì²´ í–‰ì—ì„œ í•´ë‹¹ ì‚¬ìš©ì ì°¾ê¸°
    table.rows().every(function() {
        const rowData = this.data();
        const cellText = $('<div>' + rowData[0] + '</div>').text().trim(); 
        if (cellText === usernameToFind) {
            targetRowIndex = this.index();
            return false; 
        }
    });

    if (targetRowIndex !== null) {
        searchModal.hide();
        
        setTimeout(function() {
            $('.modal-backdrop').remove();
            $('body').removeClass('modal-open');
            $('body').css({'overflow': 'auto', 'padding-right': ''});
        }, 100);
        
        setTimeout(function() {
            // í•´ë‹¹ í–‰ì´ ìˆëŠ” í˜ì´ì§€ë¡œ ì´ë™
            const pageInfo = table.page.info();
            const pageSize = pageInfo.length;
            const targetPage = Math.floor(targetRowIndex / pageSize);
            
            // í˜ì´ì§€ ì´ë™ (false = í˜ì´ì§€ ë²ˆí˜¸ ë¦¬ì…‹ ì•ˆ í•¨)
            table.page(targetPage).draw(false);
            
            // í˜ì´ì§€ ì´ë™ í›„ DOMì´ ì—…ë°ì´íŠ¸ë˜ë©´ ìŠ¤í¬ë¡¤
            setTimeout(function() {
                const $targetRow = $(table.row(targetRowIndex).node());
                
                if ($targetRow && $targetRow.length) {
                    $('html, body').animate({
                        scrollTop: $targetRow.offset().top - 150 
                    }, 500);

                    $targetRow.addClass('table-warning');
                    setTimeout(function() {
                        $targetRow.removeClass('table-warning');
                    }, 2000);
                }
            }, 100);
        }, 300);
    }
});

		searchModalElement.addEventListener('shown.bs.modal', function () {
			$usernameInput.focus();
		});
		twemoji.parse(document.body);
		});
	</script>

<div class="fixed-bottom d-flex flex-column align-items-end p-4" style="z-index: 1050; left:auto;">
    <div class="dropdown dropup mb-3">
        <button class="btn btn-primary btn-lg rounded-circle shadow-lg fab-custom-size" 
                type="button" 
                id="fabSortDropdown" 
                data-bs-toggle="dropdown" 
                data-bs-auto-close="true"
                aria-expanded="false"
                style="width: 60px; height: 60px;">
            <i class="fas fa-sort-amount-down-alt"></i>
        </button>
        <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="fabSortDropdown" style="z-index: 1051; position: absolute; bottom: 100%; margin-bottom: 0.5rem;">
            <li class="dropdown-header">ì •ë ¬ ê¸°ì¤€ ì„ íƒ</li>
            <li><a class="dropdown-item sort-option" href="#" data-column="1" data-default-dir="asc">{{t['pre_rank']}}</a></li>
            <li><a class="dropdown-item sort-option" href="#" data-column="2" data-default-dir="asc">{{t['curr_rank']}}</a></li>
            <li><a class="dropdown-item sort-option" href="#" data-column="3" data-default-dir="desc">{{t['rank_change']}}</a></li>
            <li><a class="dropdown-item sort-option" href="#" data-column="4" data-default-dir="desc">{{t['pre']}} {{ metric_display_name }}</a></li>
            <li><a class="dropdown-item sort-option" href="#" data-column="5" data-default-dir="desc">{{t['cur']}} {{ metric_display_name }}</a></li>
            <li><a class="dropdown-item sort-option" href="#" data-column="6" data-default-dir="desc">{{ metric_display_name }} {{t['change']}}</a></li>
        </ul>
    </div>
    
    <div class="d-flex align-items-center">
		<button class="btn btn-secondary btn-lg rounded-circle shadow-lg me-3 fab-custom-size" 
				type="button" 
				id="fabScrollTop" 
				style="background-color: #6c757d !important; border-color: #6c757d !important; display: none;"> 
			<i class="fas fa-arrow-up"></i>
		</button>
        
        <button class="btn btn-info btn-lg rounded-circle shadow-lg fab-custom-size" 
                type="button" 
                data-bs-toggle="modal" 
                data-bs-target="#searchModal"
                style="width: 60px; height: 60px;">
            <i class="fas fa-search"></i>
        </button> 
    </div>
</div>

% include('_footer.html')
<div class="modal fade" id="searchModal" tabindex="-1" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">{{t['user_analysis']}}</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label class="form-label">{{t['user']}}:</label>
                    <input type="text" class="form-control" id="usernameInput" placeholder="{{t['search_placeholder']}}" autocomplete="off">
                </div>
                <div id="searchResults" class="list-group" style="max-height: 300px; overflow-y: auto;">
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">{{t['close']}}</button>
            </div>
        </div>
    </div>
</div>
<script>
	// Initialize FAB dropdown manually (only for FAB, not navbar)
	document.addEventListener('DOMContentLoaded', function() {
		const dropdownButton = document.getElementById('fabSortDropdown');
		if (dropdownButton) {
			// FAB ë“œë¡­ë‹¤ìš´ë§Œ ìˆ˜ë™ìœ¼ë¡œ ì´ˆê¸°í™”
			// navbar ë“œë¡­ë‹¤ìš´ì€ ìë™ìœ¼ë¡œ Bootstrapì´ ì²˜ë¦¬í•˜ë„ë¡ ë‘ 
			dropdownButton.addEventListener('click', function(e) {
				console.log('FAB Dropdown clicked');
				// ì´ ì´ë²¤íŠ¸ë§Œ ì „íŒŒ ì¤‘ì§€ (navbarì—ëŠ” ì˜í–¥ ì—†ìŒ)
				e.stopPropagation();
			});
		}
	});

	const scrollTopButton = document.getElementById('fabScrollTop');
	const scrollThreshold = 300; 

	window.addEventListener('scroll', function() {
		if (window.scrollY > scrollThreshold) {
			scrollTopButton.style.display = 'flex';
		} else {
			scrollTopButton.style.display = 'none';
		}
	});

	scrollTopButton.addEventListener('click', function(e) {
		e.preventDefault();
		$('html, body').animate({
			scrollTop: 0
		}, 500); 
	});
	function copyWalletAddress() {
		const addr = "0xC8e695B30EF512AE634007efa89A75E1421e3055";
		
		navigator.clipboard.writeText(addr).then(() => {
			// í† ìŠ¤íŠ¸ ìš”ì†Œ ê°€ì ¸ì˜¤ê¸°
			const toastElement = document.getElementById('copyToast');
			
			// Bootstrap í† ìŠ¤íŠ¸ ì¸ìŠ¤í„´ìŠ¤ ìƒì„± ë° ì‹¤í–‰
			const toast = new bootstrap.Toast(toastElement, {
				autohide: true,
				delay: 1000 // 2ì´ˆ ë’¤ ìë™ ì‚¬ë¼ì§
			});
			toast.show();
		}).catch(err => {
			console.error('ë³µì‚¬ ì‹¤íŒ¨:', err);
		});
	}
	function resetToRecent() {
		// 1. í˜„ì¬ í™”ë©´ì—ì„œ í•„ìš”í•œ ê°’ë§Œ ì½ì–´ì˜µë‹ˆë‹¤.
		const tf = document.getElementById('timeframe').value;
		const mt = document.getElementById('metric').value; // metricë„ ìœ ì§€í•˜ê³  ì‹¶ì„ ê²½ìš°
		
		const project = "{{project}}";
		
		// 2. [í•µì‹¬] í˜„ì¬ URLì˜ íŒŒë¼ë¯¸í„°ë¥¼ ì‹¹ ë¬´ì‹œí•˜ê³ , 
		// ê¸°ë³¸ ê²½ë¡œì— í•„ìš”í•œ ê°’ë§Œ ë”± ë¶™ì—¬ì„œ ì´ë™í•©ë‹ˆë‹¤.
		const newUrl = `/${project}/leaderboard?timeframe=${tf}&metric=${mt}`;
		
		// ì´ë™
		window.location.href = newUrl;
	}
	</script>
</script>
<script>
	function updateFilters() {
		// 1. í˜„ì¬ ì„ íƒëœ ë‘ ê°€ì§€ í•„í„° ê°’ë§Œ ê°€ì ¸ì˜´
		const tf = document.getElementById('timeframe').value;
		const mt = document.getElementById('metric').value;
		
		// 2. í”„ë¡œì íŠ¸ ê²½ë¡œ (ì„œë²„ì—ì„œ ë‚´ë ¤ì¤€ ë³€ìˆ˜ í™œìš©)
		const project = "{{project}}";
		
		// 3. timestampë¥¼ ì œì™¸í•œ ìˆœìˆ˜ í•„í„°ê°’ë§Œ ì¿¼ë¦¬ ìŠ¤íŠ¸ë§ìœ¼ë¡œ êµ¬ì„±
		// window.location.pathnameì„ ì‚¬ìš©í•˜ì—¬ í˜„ì¬ ì£¼ì†Œ ë’¤ì˜ íŒŒë¼ë¯¸í„°ë¥¼ ì´ˆê¸°í™”í•¨
		window.location.href = window.location.pathname + "?timeframe=" + tf + "&metric=" + mt;
	}

	// ê¸°ì¡´ì— ë§Œë“¤ì—ˆë˜ resetToRecentë„ ìœ„ í•¨ìˆ˜ë¥¼ ì¬ì‚¬ìš©í•˜ë©´ ê¹”ë”í•©ë‹ˆë‹¤.
	function resetToRecent() {
		updateFilters();
	}
</script>
<script>
  $(document).ready(function() {
    // íŠ¹ì • ìš”ì†Œ(ì˜ˆ: ë°”ë”” ì „ì²´) ë‚´ì˜ ì´ëª¨í‹°ì½˜ì„ ì´ë¯¸ì§€ë¡œ ë³€í™˜
    twemoji.parse(document.body);
  });
</script>

</body>

</html>