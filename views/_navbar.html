<nav class="navbar navbar-expand-lg navbar-light bg-white sticky-top">
    <div class="container">
        <div class="d-flex align-items-center">
            <img src="/static/cookie_shark.png" width="32" height="32" class="me-2">
            <span class="text-info me-1 fw-bold" style="padding: 5; font-size: 1.2rem; letter-spacing: 1px; user-select: none; cursor: default;">SHARKAPP</span>

            <div class="dropdown">
                <button class="project-switcher dropdown-toggle text-dark" type="button" id="projectDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                    <% 
                        flags = {'ko': 'üá∞üá∑', 'en': 'üåê','global': 'üåê', 'zh': 'üá®üá≥', 'pt': 'üáµüáπ', 'es': 'üá™üá∏'}
                        current_parts = project.rsplit('-', 1)
                        current_name = current_parts[0].upper()
                        current_lang = current_parts[1].lower() if len(current_parts) > 1 else ''
                        current_flag = flags.get(current_lang, '')
                    %>
                    {{current_flag}} {{current_name}}
                </button>
                <ul class="dropdown-menu shadow border-0" style="padding: 5px; background-color: rgba(255,255,255,0.6); backdrop-filter: blur(6px); margin-left: -50px;" aria-labelledby="projectDropdown">
                    
                    <!-- Kaito ÌîÑÎ°úÏ†ùÌä∏ (ÏµúÏÉÅÎã®) -->
                    % if kaito_projects:
                        <li>
                            <a class="dropdown-header text-warning fw-bold d-flex justify-content-between align-items-center project-header" style="cursor: pointer;" data-bs-toggle="modal" data-bs-target="#kaitoProjectModal" onclick="event.stopPropagation();">
                                <span class="project-header-bg" style="display:inline-flex;align-items:center;gap:0.5rem;width:100%;padding:0.35rem 0.6rem;border-radius:6px;"><img src="/static/kaito.png" alt="Kaito" style="width: 20px; height: 20px;"> Kaito<i class="fas fa-chevron-right" style="font-size: 0.8rem;margin-left:auto;"></i></span>
                            </a>
                        </li>
                    % end
                    
                    <!-- Wallchain ÌîÑÎ°úÏ†ùÌä∏ -->
                    % if grouped_wallchain:
                        % if kaito_projects:
                            <li><hr class="dropdown-divider"></li>
                        % end
                        <li>
                            <a class="dropdown-header text-info fw-bold d-flex justify-content-between align-items-center project-header" style="cursor: pointer;" data-bs-toggle="collapse" data-bs-target="#wallchainProjectsCollapse" aria-expanded="false" onclick="event.stopPropagation();">
                                <span class="project-header-bg" style="display:inline-flex;align-items:center;gap:0.5rem;width:100%;padding:0.35rem 0.6rem;border-radius:6px;">ü¶Ü Wallchain<i class="fas fa-chevron-down" style="font-size: 0.8rem;margin-left:auto;"></i></span>
                            </a>
                        </li>
                        <div class="collapse" id="wallchainProjectsCollapse">
                        <% 
                            # Í∑∏Î£πÌôîÎêú ÌîÑÎ°úÏ†ùÌä∏(len > 1)Î•º ÏÉÅÎã®Ïóê, Îã®Ïùº ÌîÑÎ°úÏ†ùÌä∏Î•º ÌïòÎã®Ïóê Î∞∞Ïπò
                            sorted_wall_projects = sorted(grouped_wallchain.keys(), key=lambda x: (len(grouped_wallchain[x]) == 1, x))
                        %>
                        % for proj_name in sorted_wall_projects:
                            <% items = grouped_wallchain[proj_name] %>
                            % if len(items) == 1:
                                <% 
                                    item = items[0]
                                    flags_map = {'ko': 'üá∞üá∑', 'en': 'üåê','global': 'üåê', 'zh': 'üá®üá≥', 'pt': 'üáµüáπ', 'es': 'üá™üá∏'}
                                    p_flag = flags_map.get(item['lang'].lower(), '')
                                %>
                                <li>
                                    <a class="dropdown-item" href="/wallchain/{{item['full']}}/leaderboard">
                                        {{p_flag}} {{proj_name.upper()}}
                                    </a>
                                </li>
                            % else:
                                <li>
                                    <a class="dropdown-item d-flex justify-content-between align-items-center" style="font-weight: 600; cursor: pointer;" data-bs-toggle="collapse" data-bs-target="#wall-{{proj_name}}" aria-expanded="false" onclick="event.stopPropagation();">
                                        {{proj_name.upper()}}
                                        <i class="fas fa-chevron-down" style="font-size: 0.8rem;"></i>
                                    </a>
                                    <div class="collapse" id="wall-{{proj_name}}">
                                        % for item in sorted(items, key=lambda x: x['lang']):
                                            <% 
                                                flags_map = {'ko': 'üá∞üá∑', 'en': 'üåê','global': 'üåê', 'zh': 'üá®üá≥', 'pt': 'üáµüáπ', 'es': 'üá™üá∏'}
                                                lang_names = {'en': 'GLOBAL', 'global': 'GLOBAL', 'es': 'Spanish', 'pt': 'Portuguese', 'zh': 'Chinese', 'ko': 'Korean'}
                                                p_flag = flags_map.get(item['lang'].lower(), '')
                                                lang_display = lang_names.get(item['lang'].lower(), item['lang'].upper())
                                            %>
                                            <a class="dropdown-item" style="padding-left: 2.5rem;" href="/wallchain/{{item['full']}}/leaderboard">
                                                {{p_flag}} {{lang_display}}
                                            </a>
                                        % end
                                    </div>
                                </li>
                            % end
                        % end
                        </div>
                    % end
                    
                    <!-- Cookie ÌîÑÎ°úÏ†ùÌä∏ -->
                    % if grouped_projects:
                        % if grouped_wallchain or kaito_projects:
                            <li><hr class="dropdown-divider"></li>
                        % end
                        <li>
                            <a class="dropdown-header text-primary fw-bold d-flex justify-content-between align-items-center project-header" style="cursor: pointer;" data-bs-toggle="collapse" data-bs-target="#cookieProjectsCollapse" aria-expanded="false" onclick="event.stopPropagation();">
                                <span class="project-header-bg" style="display:inline-flex;align-items:center;gap:0.5rem;width:100%;padding:0.35rem 0.6rem;border-radius:6px;">üç™ Cookie<i class="fas fa-chevron-down" style="font-size: 0.8rem;margin-left:auto;"></i></span>
                            </a>
                        </li>
                        <div class="collapse" id="cookieProjectsCollapse">
                        <% 
                            # Í∑∏Î£πÌôîÎêú ÌîÑÎ°úÏ†ùÌä∏(len > 1)Î•º ÏÉÅÎã®Ïóê, Îã®Ïùº ÌîÑÎ°úÏ†ùÌä∏Î•º ÌïòÎã®Ïóê Î∞∞Ïπò
                            sorted_cookie_projects = sorted(grouped_projects.keys(), key=lambda x: (len(grouped_projects[x]) == 1, x))
                        %>
                        % for proj_name in sorted_cookie_projects:
                            <% items = grouped_projects[proj_name] %>
                            % if len(items) == 1:
                                <% 
                                    item = items[0]
                                    flags_map = {'ko': 'üá∞üá∑', 'en': 'üåê','global': 'üåê', 'zh': 'üá®üá≥', 'pt': 'üáµüáπ', 'es': 'üá™üá∏'}
                                    p_flag = flags_map.get(item['lang'].lower(), '')
                                %>
                                <li>
                                    <a class="dropdown-item" href="/cookie/{{item['full']}}/leaderboard">
                                        {{p_flag}} {{proj_name.upper()}}
                                    </a>
                                </li>
                            % else:
                                <li>
                                    <a class="dropdown-item d-flex justify-content-between align-items-center" style="font-weight: 600; cursor: pointer;" data-bs-toggle="collapse" data-bs-target="#cookie-{{proj_name}}" aria-expanded="false" onclick="event.stopPropagation();">
                                        {{proj_name.upper()}}
                                        <i class="fas fa-chevron-down" style="font-size: 0.8rem;"></i>
                                    </a>
                                    <div class="collapse" id="cookie-{{proj_name}}">
                                        % for item in sorted(items, key=lambda x: x['lang']):
                                            <% 
                                                flags_map = {'ko': 'üá∞üá∑', 'en': 'üåê','global': 'üåê', 'zh': 'üá®üá≥', 'pt': 'üáµüáπ', 'es': 'üá™üá∏'}
                                                lang_names = {'en': 'GLOBAL', 'global': 'GLOBAL', 'es': 'Spanish', 'pt': 'Portuguese', 'zh': 'Chinese', 'ko': 'Korean'}
                                                p_flag = flags_map.get(item['lang'].lower(), '')
                                                lang_display = lang_names.get(item['lang'].lower(), item['lang'].upper())
                                            %>
                                            <a class="dropdown-item" style="padding-left: 2.5rem;" href="/cookie/{{item['full']}}/leaderboard">
                                                {{p_flag}} {{lang_display}}
                                            </a>
                                        % end
                                    </div>
                                </li>
                            % end
                        % end
                        </div>
                    % end
                    
                </ul>
            </div>
        </div>

        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav ms-auto ms-lg-4 me-lg-auto text-end text-lg-start">
                <%
                    # ÌòÑÏû¨ ÌéòÏù¥ÏßÄÍ∞Ä wallchainÏù∏ÏßÄ, Í∏ÄÎ°úÎ≤å Í≤ÄÏÉâÏù∏ÏßÄ ÌôïÏù∏
                    is_wallchain = get('is_wallchain', False)
                    is_kaito = get('is_kaito', False)
                    is_global = (project == 'SEARCH' or current_page == 'user_lookup')
                    
                    if not is_global:
                        if is_kaito:
                            base_url = f"/kaito/{project}"
                        elif is_wallchain:
                            base_url = f"/wallchain/{project}"
                        else:
                            base_url = f"/cookie/{project}"
                        end
                    end
                %>
                % if not is_global:
                    <li class="nav-item">
                        <a class="nav-link {{'active' if current_page == 'user' else ''}}" href="{{base_url}}/">{{t['user_analysis']}}</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link {{'active' if current_page == 'leaderboard' else ''}}" href="{{base_url}}/leaderboard">{{t['leaderboard_analysis']}}</a>
                    </li>
                % end
                <li class="nav-item">
                    <a class="nav-link {{'active' if current_page == 'user_lookup' else ''}}" href="/user-lookup">
                        <i class="fas fa-search"></i> {{'ÌÜµÌï© Í≤ÄÏÉâ' if lang == 'ko' else 'Global Search'}}
                    </a>
                </li>
            </ul>
                    
            <div class="d-flex align-items-center justify-content-end justify-content-lg-start gap-2">
                <div class="creator-badge me-0" data-bs-toggle="modal" data-bs-target="#creatorModal">
                    <img src="/static/ohoshark.png" style="flex-shrink: 0;" alt="ohoshark">
                    <span>Created by ohoshark</span>
                </div>
                <div class="btn-group btn-group-sm">
                    <a href="/set_lang/ko" class="btn btn-outline-secondary {{'active' if lang == 'ko' else ''}}">KO</a>
                    <a href="/set_lang/en" class="btn btn-outline-secondary {{'active' if lang == 'en' else ''}}">EN</a>
                </div>
                <button id="themeToggle" class="btn btn-outline-secondary btn-sm d-flex align-items-center justify-content-center" style="width: 40px; height: 32px;" title="Toggle theme">
                    <i class="fas fa-moon" id="themeIcon"></i>
                </button>
            </div>
        </div>
    </div>
</nav>
<!-- Kaito ÌîÑÎ°úÏ†ùÌä∏ ÏÑ†ÌÉù Î™®Îã¨ -->
% if kaito_projects:
<div class="modal fade" id="kaitoProjectModal" tabindex="-1" aria-labelledby="kaitoProjectModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-scrollable">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="kaitoProjectModalLabel"><img src="/static/kaito.png" alt="Kaito" style="width: 20px; height: 20px;"> KAITO ÌîÑÎ°úÏ†ùÌä∏ ÏÑ†ÌÉù ({{len(kaito_projects)}}Í∞ú)</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <!-- Í≤ÄÏÉâ ÏûÖÎ†• -->
                <div class="mb-3">
                    <input type="text" id="kaitoProjectSearch" class="form-control" placeholder="ÌîÑÎ°úÏ†ùÌä∏ Ïù¥Î¶ÑÏúºÎ°ú Í≤ÄÏÉâ...">
                </div>
                
                <!-- ÌîÑÎ°úÏ†ùÌä∏ Î™©Î°ù -->
                <div class="row g-2" id="kaitoProjectList">
                    % for kaito_proj in sorted(kaito_projects):
                        <div class="col-md-6 col-lg-4 kaito-project-item" data-project-name="{{kaito_proj.lower()}}">
                            <a href="/kaito/{{kaito_proj}}/leaderboard" class="btn btn-outline-primary w-100 text-start" style="text-transform: uppercase;">
                                üåê {{kaito_proj}}
                            </a>
                        </div>
                    % end
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Kaito ÌîÑÎ°úÏ†ùÌä∏ Í≤ÄÏÉâ Í∏∞Îä•
document.addEventListener('DOMContentLoaded', function() {
    const searchInput = document.getElementById('kaitoProjectSearch');
    const projectItems = document.querySelectorAll('.kaito-project-item');
    
    if (searchInput) {
        searchInput.addEventListener('input', function() {
            const query = this.value.toLowerCase().trim();
            
            projectItems.forEach(item => {
                const projectName = item.getAttribute('data-project-name');
                if (projectName.includes(query)) {
                    item.style.display = '';
                } else {
                    item.style.display = 'none';
                }
            });
        });
        
        // Î™®Îã¨Ïù¥ Ïó¥Î¶¥ Îïå Í≤ÄÏÉâ ÏûÖÎ†• Ï¥àÍ∏∞Ìôî Î∞è Ìè¨Ïª§Ïä§
        const modal = document.getElementById('kaitoProjectModal');
        modal.addEventListener('shown.bs.modal', function() {
            searchInput.value = '';
            searchInput.focus();
            projectItems.forEach(item => item.style.display = '');
        });
    }
});
</script>
% end