<nav class="navbar navbar-expand-lg navbar-light bg-white sticky-top">
    <div class="container">
        <div class="d-flex align-items-center">
            <img src="/static/cookie_shark.png" width="32" height="32" class="me-2">
            <span class="text-info me-1 fw-bold" style="padding: 5; font-size: 1.2rem; letter-spacing: 1px; user-select: none; cursor: default;">SHARKAPP</span>

            <div class="dropdown">
                <button class="project-switcher dropdown-toggle text-dark" type="button" id="projectDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                    <% 
                        flags = {'ko': 'üá∞üá∑', 'en': 'üåê','global': 'üåê', 'zh': 'üá®üá≥', 'pt': 'üáµüáπ', 'es': 'üá™üá∏'}
                        current_parts = project.rsplit('-', 1)
                        current_name = current_parts[0].upper()
                        current_lang = current_parts[1].lower() if len(current_parts) > 1 else ''
                        current_flag = flags.get(current_lang, '')
                    %>
                    {{current_flag}} {{current_name}}
                </button>
                <ul class="dropdown-menu shadow border-0" style="padding: 5px; background-color: rgba(255,255,255,0.6); backdrop-filter: blur(6px); margin-left: -50px;" aria-labelledby="projectDropdown">
                    % if grouped_wallchain:
                        <li>
                            <a class="dropdown-header text-info fw-bold d-flex justify-content-between align-items-center project-header" style="cursor: pointer;" data-bs-toggle="collapse" data-bs-target="#wallchainProjectsCollapse" aria-expanded="false" onclick="event.stopPropagation();">
                                <span style="display:inline-flex;align-items:center;gap:0.5rem;width:100%;padding:0.35rem 0.6rem;border-radius:6px;background-color:#f7fbff;">ü¶Ü Wallchain<i class="fas fa-chevron-down" style="font-size: 0.8rem;margin-left:auto;"></i></span>
                            </a>
                        </li>
                        <div class="collapse" id="wallchainProjectsCollapse">
                        <% 
                            # Í∑∏Î£πÌôîÎêú ÌîÑÎ°úÏ†ùÌä∏(len > 1)Î•º ÏÉÅÎã®Ïóê, Îã®Ïùº ÌîÑÎ°úÏ†ùÌä∏Î•º ÌïòÎã®Ïóê Î∞∞Ïπò
                            sorted_wall_projects = sorted(grouped_wallchain.keys(), key=lambda x: (len(grouped_wallchain[x]) == 1, x))
                        %>
                        % for proj_name in sorted_wall_projects:
                            <% items = grouped_wallchain[proj_name] %>
                            % if len(items) == 1:
                                <% 
                                    item = items[0]
                                    flags_map = {'ko': 'üá∞üá∑', 'en': 'üåê','global': 'üåê', 'zh': 'üá®üá≥', 'pt': 'üáµüáπ', 'es': 'üá™üá∏'}
                                    p_flag = flags_map.get(item['lang'].lower(), '')
                                %>
                                <li>
                                    <a class="dropdown-item" href="/wallchain/{{item['full']}}/leaderboard">
                                        {{p_flag}} {{proj_name.upper()}}
                                    </a>
                                </li>
                            % else:
                                <li>
                                    <a class="dropdown-item d-flex justify-content-between align-items-center" style="font-weight: 600; cursor: pointer;" data-bs-toggle="collapse" data-bs-target="#wall-{{proj_name}}" aria-expanded="false" onclick="event.stopPropagation();">
                                        {{proj_name.upper()}}
                                        <i class="fas fa-chevron-down" style="font-size: 0.8rem;"></i>
                                    </a>
                                    <div class="collapse" id="wall-{{proj_name}}">
                                        % for item in sorted(items, key=lambda x: x['lang']):
                                            <% 
                                                flags_map = {'ko': 'üá∞üá∑', 'en': 'üåê','global': 'üåê', 'zh': 'üá®üá≥', 'pt': 'üáµüáπ', 'es': 'üá™üá∏'}
                                                lang_names = {'en': 'GLOBAL', 'global': 'GLOBAL', 'es': 'Spanish', 'pt': 'Portuguese', 'zh': 'Chinese', 'ko': 'Korean'}
                                                p_flag = flags_map.get(item['lang'].lower(), '')
                                                lang_display = lang_names.get(item['lang'].lower(), item['lang'].upper())
                                            %>
                                            <a class="dropdown-item" style="padding-left: 2.5rem;" href="/wallchain/{{item['full']}}/leaderboard">
                                                {{p_flag}} {{lang_display}}
                                            </a>
                                        % end
                                    </div>
                                </li>
                            % end
                        % end
                        </div>
                    % end
                    
                    % if grouped_projects:
                        % if grouped_wallchain:
                            <li><hr class="dropdown-divider"></li>
                        % end
                        <li>
                            <a class="dropdown-header text-primary fw-bold d-flex justify-content-between align-items-center project-header" style="cursor: pointer;" data-bs-toggle="collapse" data-bs-target="#cookieProjectsCollapse" aria-expanded="false" onclick="event.stopPropagation();">
                                <span style="display:inline-flex;align-items:center;gap:0.5rem;width:100%;padding:0.35rem 0.6rem;border-radius:6px;background-color:#f7fbff;">üç™ Cookie<i class="fas fa-chevron-down" style="font-size: 0.8rem;margin-left:auto;"></i></span>
                            </a>
                        </li>
                        <div class="collapse" id="cookieProjectsCollapse">
                        <% 
                            # Í∑∏Î£πÌôîÎêú ÌîÑÎ°úÏ†ùÌä∏(len > 1)Î•º ÏÉÅÎã®Ïóê, Îã®Ïùº ÌîÑÎ°úÏ†ùÌä∏Î•º ÌïòÎã®Ïóê Î∞∞Ïπò
                            sorted_cookie_projects = sorted(grouped_projects.keys(), key=lambda x: (len(grouped_projects[x]) == 1, x))
                        %>
                        % for proj_name in sorted_cookie_projects:
                            <% items = grouped_projects[proj_name] %>
                            % if len(items) == 1:
                                <% 
                                    item = items[0]
                                    flags_map = {'ko': 'üá∞üá∑', 'en': 'üåê','global': 'üåê', 'zh': 'üá®üá≥', 'pt': 'üáµüáπ', 'es': 'üá™üá∏'}
                                    p_flag = flags_map.get(item['lang'].lower(), '')
                                %>
                                <li>
                                    <a class="dropdown-item" href="/cookie/{{item['full']}}/leaderboard">
                                        {{p_flag}} {{proj_name.upper()}}
                                    </a>
                                </li>
                            % else:
                                <li>
                                    <a class="dropdown-item d-flex justify-content-between align-items-center" style="font-weight: 600; cursor: pointer;" data-bs-toggle="collapse" data-bs-target="#cookie-{{proj_name}}" aria-expanded="false" onclick="event.stopPropagation();">
                                        {{proj_name.upper()}}
                                        <i class="fas fa-chevron-down" style="font-size: 0.8rem;"></i>
                                    </a>
                                    <div class="collapse" id="cookie-{{proj_name}}">
                                        % for item in sorted(items, key=lambda x: x['lang']):
                                            <% 
                                                flags_map = {'ko': 'üá∞üá∑', 'en': 'üåê','global': 'üåê', 'zh': 'üá®üá≥', 'pt': 'üáµüáπ', 'es': 'üá™üá∏'}
                                                lang_names = {'en': 'GLOBAL', 'global': 'GLOBAL', 'es': 'Spanish', 'pt': 'Portuguese', 'zh': 'Chinese', 'ko': 'Korean'}
                                                p_flag = flags_map.get(item['lang'].lower(), '')
                                                lang_display = lang_names.get(item['lang'].lower(), item['lang'].upper())
                                            %>
                                            <a class="dropdown-item" style="padding-left: 2.5rem;" href="/cookie/{{item['full']}}/leaderboard">
                                                {{p_flag}} {{lang_display}}
                                            </a>
                                        % end
                                    </div>
                                </li>
                            % end
                        % end
                        </div>
                    % end
                </ul>
            </div>
        </div>

        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav ms-auto ms-lg-4 me-lg-auto text-end text-lg-start">
                <%
                    # ÌòÑÏû¨ ÌéòÏù¥ÏßÄÍ∞Ä wallchainÏù∏ÏßÄ, Í∏ÄÎ°úÎ≤å Í≤ÄÏÉâÏù∏ÏßÄ ÌôïÏù∏
                    is_wallchain = get('is_wallchain', False)
                    is_global = (project == 'SEARCH' or current_page == 'user_lookup')
                    
                    if not is_global:
                        base_url = f"/wallchain/{project}" if is_wallchain else f"/cookie/{project}"
                    end
                %>
                % if not is_global:
                    <li class="nav-item">
                        <a class="nav-link {{'active' if current_page == 'user' else ''}}" href="{{base_url}}/">{{t['user_analysis']}}</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link {{'active' if current_page == 'leaderboard' else ''}}" href="{{base_url}}/leaderboard">{{t['leaderboard_analysis']}}</a>
                    </li>
                % end
                <li class="nav-item">
                    <a class="nav-link {{'active' if current_page == 'user_lookup' else ''}}" href="/user-lookup">
                        <i class="fas fa-search"></i> {{'ÌÜµÌï© Í≤ÄÏÉâ' if lang == 'ko' else 'Global Search'}}
                    </a>
                </li>
            </ul>
                    
            <div class="creator-badge me-2 text-end text-lg-start" data-bs-toggle="modal" data-bs-target="#creatorModal">
                <img src="/static/ohoshark.png" style="flex-shrink: 0;" alt="ohoshark">
                <span>Created by ohoshark</span>
            </div>
            <div class="btn-group btn-group-sm me-3 d-flex justify-content-end justify-content-lg-start">
                <a href="/set_lang/ko" class="btn btn-outline-secondary {{'active' if lang == 'ko' else ''}}">KO</a>
                <a href="/set_lang/en" class="btn btn-outline-secondary {{'active' if lang == 'en' else ''}}">EN</a>
            </div>
        </div>
    </div>
</nav>
